<%- include('../includes/userHeader.ejs') %>

<div class="breadcrumbs">
  <div class="container">
    <div class="row">
      <div class="col">
        <p class="bread"><span><a href="index.html">Home</a></span> / <span>Shopping Cart</span></p>
      </div>
    </div>
  </div>
</div>

<% if (allCart.items.length !=0) { %> 
<div class="colorlib-product">
  <div class="container">
    <form >
    <div class="row row-pb-lg">
      <div class="col-md-10 offset-md-1">
        <div class="process-wrap">
          <div class="process text-center active">
            <p><span>01</span></p>
            <h3>Shopping Cart</h3>
          </div>
          <div class="process text-center">
            <p><span>02</span></p>
            <h3>Checkout</h3>
          </div>
          <div class="process text-center">
            <p><span>03</span></p>
            <h3>Order Complete</h3>
          </div>
        </div>
      </div>
     </div>
      <div class="row row-pb-lg">
      <div class="col-md-12">
        <div class="product-name d-flex">
          <div class="one-forth text-left px-4">
            <span>Product Details</span>
          </div>
          <div class="one-eight text-center">
            <span>Price</span>
          </div>
          <div class="one-eight text-center">
            <span>Quantity</span>
          </div>
          <div class="one-eight text-center">
            <span>Total</span>
          </div>
          <div class="one-eight text-center px-4">
            <span>Remove</span>
          </div>
        </div>

        <% for ( cart of allCart.items) { %>
        <div class="product-cart d-flex">
          <div class="one-forth">
            <div class="product-img" >
              <img
              src="/images/<%= cart.product.imageUrl[0]%>"
              alt=""
              loading="lazy"
              style="width: 100px; height: auto"
            />
            </div>
            <div class="display-tc">
              <h3><%= cart.product.name %></h3>
            </div>
          </div>
          <div class="one-eight text-center">
            <div class="display-tc">
              <span class="price">₹<%= cart.product.price %></span>
            </div>
          </div>
          <div class="one-eight text-center">
            <div class="display-tc">
              <!-- <a href="/cart-change-quantity/<%= allCart._id %>/<%= cart.product._id %>/1"> -->
                
              <a style="cursor: pointer;" onclick="changeQuantity('<%= allCart._id %>','<%= cart.product._id %>','1')"> <span class="  material-symbols-outlined">add</span></a>
                      
                <!-- </a> -->
              <input type="number" id="qty" name="quantity" class="form-control input-number text-center" value="<%= cart.quantity %>"  readonly>
              <% if (cart.quantity>1) { %>
               
              
              <!-- <a   href="/cart-change-quantity/<%= allCart._id %>/<%= cart.product._id %>/-1"> -->
                <a style="cursor: pointer;" onclick="changeQuantity('<%= allCart._id %>','<%= cart.product._id %>','-1')">
                <span class=" material-symbols-outlined">
                  remove
                </span>
            </a>
                <!-- </a> -->
              <% } else { %>
                <a  style="visibility:hidden ;" onclick="changeQuantity('<%= allCart._id %>','<%= cart.product._id %>','-1')">
                  <span class=" material-symbols-outlined">
                    remove
                  </span>
              </a>
                <% } %>
            </div>
          </div>
          <div class="one-eight text-center">
            <div class="display-tc">
              <span class="price">₹<%= cart.totalPrice %></span>
            </div>
          </div>
          <div class="one-eight text-center">
            <div class="display-tc">
              <a href="#" onclick="deleteProduct('<%= cart.product._id  %>')" class="closed"></a>
              <!-- <a href="/cart-delete-product/<%= cart.product._id  %>" class="closed"></a> -->
            </div>
          </div>
        </div>
        <% } %> 
      
      </div>
     </div>
     <div class="row row-pb-lg">
      <div class="col-md-12">
        <div class="total-wrap">
          <div class="row">
            <!-- <div class="col-sm-8">
              <form action="#">
                <div class="row form-group">
                  <div class="col-sm-9">
                    <input type="text" name="quantity" class="form-control input-number" placeholder="Your Coupon Number...">
                  </div>
                  <div class="col-sm-3">
                    <input type="submit" value="Apply Coupon" class="btn btn-primary">
                  </div>
                </div>
              </form>
            </div> -->
            <div class="col-sm-4 text-center">
              <div class="total">
                <div class="sub">
                  <p><span>Subtotal:</span> <span>₹<%= allCart.cartTotal %></span></p>
                  <p><span>Delivery:</span> <span>₹FREE</span></p>
                  <!-- <p><span>Discount:</span> <span>$45.00</span></p> -->
                </div>
                <div class="grand-total">
                  <p><span><strong>Total:</strong></span> <span> ₹<%= allCart.cartTotal %></span></p>
                </div>
              </div>
              <div class="col-sm-8">
          
                <div class="row form-group">
                  <!-- <div class="col-sm-9">
                    <input
                      type="text"
                      name="quantity"
                      class="form-control input-number"
                      placeholder="Your Coupon Number..."
                    />
                  </div> -->
                  <% if(notAvailable.length>0){ %> 
                      <div class=" alert alert-danger mt-3 ml-5" role="alert">
                        <p class="text-danger"><%=notAvailable %> </p>
                      </div>
                    <% } %>
                     
                  <div class="col-sm-3 mt-3 ml-4">
                   <a href="/checkout" class="btn btn-primary" >
                       Proceed to Checkout
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        



       
          
        </div>
      </div>
    </form>

   
    <% } else { %>
      <div  class="mb-5 d-flex justify-content-center align-items-center flex-column">
        <img src="/main_images/emptyCart.png" alt=""  style="height:300px ;">
        <h5 class=" pb-3 text-center">Your cart is empty <br>Please add few products</h5>
        <a class="mb-5 btn btn-primary" href="/">Back To Home</a>
      </div>

      <% } %>


    <!-- <div class="row">
      <div class="col-sm-8 offset-sm-2 text-center colorlib-heading colorlib-heading-sm">
        <a href="/">
        <h2>Back to Home</h2>
      </a>
      </div>
    </div> -->
    <!-- <div class="row">
      <div class="col-md-3 col-lg-3 mb-4 text-center">
        <div class="product-entry border">
          <a href="#" class="prod-img">
            <img src="images/item-1.jpg" class="img-fluid" alt="Free html5 bootstrap 4 template">
          </a>
          <div class="desc">
            <h2><a href="#">Women's Boots Shoes Maca</a></h2>
            <span class="price">$139.00</span>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-lg-3 mb-4 text-center">
        <div class="product-entry border">
          <a href="#" class="prod-img">
            <img src="images/item-2.jpg" class="img-fluid" alt="Free html5 bootstrap 4 template">
          </a>
          <div class="desc">
            <h2><a href="#">Women's Minam Meaghan</a></h2>
            <span class="price">$139.00</span>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-lg-3 mb-4 text-center">
        <div class="product-entry border">
          <a href="#" class="prod-img">
            <img src="images/item-3.jpg" class="img-fluid" alt="Free html5 bootstrap 4 template">
          </a>
          <div class="desc">
            <h2><a href="#">Men's Taja Commissioner</a></h2>
            <span class="price">$139.00</span>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-lg-3 mb-4 text-center">
        <div class="product-entry border">
          <a href="#" class="prod-img">
            <img src="images/item-4.jpg" class="img-fluid" alt="Free html5 bootstrap 4 template">
          </a>
          <div class="desc">
            <h2><a href="#">Russ Men's Sneakers</a></h2>
            <span class="price">$139.00</span>
          </div>
        </div>
      </div>
    </div>
    -->
  </div>
</div>
 


  <%- include('../includes/userFooter.ejs') %>
</div>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->



  <script>
    // function changeQuantity(cartId, productId, count) {
    //   $.ajax({
    //     url: "/cart-change-quantity",
    //     data: {
    //       cartId: cartId,
    //       porductId: productId,
    //       count: count,
    //     },
    //     method: "POST",
    //     success: (response) => {
    //       alert(response);
    //     },
    //   });
    // }

    function changeQuantity(cartId,proId,count) {
           let qty = document.querySelector('#qty')
            axios.patch(`/cart?cartId=${cartId}&productId=${proId}&count=${count}`)
            .then((e) =>{
           if(e.data.stockReached){
              // alert("stock reached")

              const Toast = Swal.mixin({
               toast: true,
               position: 'top-end',
               showConfirmButton: false,
               timer: 3000,
               timerProgressBar: true,
               didOpen: (toast) => {
                 toast.addEventListener('mouseenter', Swal.stopTimer)
                 toast.addEventListener('mouseleave', Swal.resumeTimer)
               }
                })

                Toast.fire({
                  icon: 'error',
                  title: 'product is out of stock',
                })


                        
               }  else{
               
                 location.reload()
               }            
                 })
               }

      function deleteProduct(proId){
        console.log("delete vanuu-------------");
            axios.delete(`/cart?productId=${proId}`)
            .then((e =>{
                location.reload()
            }))
        }
  </script>
