<%- include('partials/header.ejs') %>

<main class="h-full pb-16 overflow-y-auto">
  <div class="container px-6 mx-auto grid">
    <h2 class="my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200">
      Orders
    </h2>

    <!-- Orders Table start -->
    <div class="w-full overflow-hidden rounded-lg shadow-xs">
      <div class="w-full overflow-x-auto">
        <table class="w-full whitespace-no-wrap">
          <thead>
            <tr
              class="text-xs font-semibold tracking-wide text-left text-gray-500 uppercase border-b dark:border-gray-700 bg-gray-50 dark:text-gray-400 dark:bg-gray-800"
            >
              <th class="px-4 py-3">Client</th>
              <th class="px-4 py-3">Order Id</th>
              <th class="px-4 py-3">paymentMethod</th>
              <th class="px-4 py-3">Amount</th>
              <th class="px-4 py-3">Order Status</th>
              <th class="px-4 py-3">Date</th>
              <th class="px-4 py-3">Details</th>
            </tr>
          </thead>
          <tbody
            class="bg-white divide-y dark:divide-gray-700 dark:bg-gray-800"
          >
            <% for( let i = 0; i < order.length; i++ ) { %>

            <tr class="text-gray-700 dark:text-gray-400">
              <td class="px-4 py-3">
                <div class="flex items-center text-sm">
                  <!-- Avatar with inset shadow -->
                  <!-- <div
                      class="relative hidden w-8 h-8 mr-3 rounded-full md:block"
                    >
                      <img
                        class="object-cover w-full h-full rounded-full"
                        src="https://images.unsplash.com/flagged/photo-1570612861542-284f4c12e75f?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=200&fit=max&ixid=eyJhcHBfaWQiOjE3Nzg0fQ"
                        alt=""
                        loading="lazy"
                      />
                      <div
                        class="absolute inset-0 rounded-full shadow-inner"
                        aria-hidden="true"
                      ></div>
                    </div> -->
                  <div>
                    <p class="font-semibold"><%= order[i].userId.name %></p>
                    <!-- <p class="text-xs text-gray-600 dark:text-gray-400">
                        10x Developer
                      </p> -->
                  </div>
                </div>
              </td>
              <td class="px-4 py-3 text-sm"><%= order[i]._id %></td>
              <td class="px-4 py-3 text-sm"><%= order[i].paymentMethod %></td>
              <td class="px-4 py-3 text-sm">â‚¹ <%= order[i].total %></td>
              <td class="px-4 py-3 text-xs">
                <!-- <span
                    class="px-2 py-1 font-semibold leading-tight text-green-700 bg-green-100 rounded-full dark:bg-green-700 dark:text-green-100"
                  >
                  <%= order[i].orderStatus %>
                  </span> -->
                  <% if (order[i].orderStatus  !=
                  "Cancelled"&&order[i].orderStatus != "Returnd" ) { %>
                    <select
                  class="px-2 py-1 font-semibold leading-tight text-green-700 bg-green-100 rounded-full dark:bg-green-700 dark:text-green-100"
                  name="track"
                  id="track<%= i %>"
                >
                  <option value="<%= order[i].orderStatus %>" selected>
                    <%= order[i].orderStatus %>
                  </option>
               
                  <option value="Cancelled">Cancelled</option>
                  <option value="orderconfirmed">orderconfirmed</option>
                  <option value="Shipped">Shipped</option>
                  <option value="Delivered">Delivered</option>
                  <option value="Out For Delivery">Out For Delivery</option>
                </select>
                <!-- <td class="px-4 py-3 text-sm"> -->
                <button
                  class="px-4 py-3 text-sm"
                  type="button"
                  id="changetrack"
                  class="btn btn-sm"
                  onclick="orderStatus('<%= order[i]._id %>','<%= i %>')"
                >
                  <span
                    class="px-2 py-1 font-semibold leading-tight text-green-700 bg-green-100 rounded-full dark:bg-green-700 dark:text-green-100"
                  >
                    Update
                  </span>
                </button>
                         
                    <% }else{ %>
                          <span
                    class="px-2 py-1 font-semibold leading-tight text-red-700 bg-red-100 rounded-full dark:text-red-100 dark:bg-red-700"
                  >
                  <%= order[i].orderStatus %>
                  </span>
               
                <% } %>
                <!-- </td> -->
              </td>

              <td class="px-4 py-3 text-sm"><%= order[i].updatedAt.toLocaleDateString() %>,<%= order[i].time %></td>
              <td class="px-4 py-3 text-xs">
                <a href="/admin/orderDetails/<%= order[i]._id %>">
                  <button>
                    <span
                      class="px-2 py-1 font-semibold leading-tight text-green-700 bg-green-100 rounded-full dark:bg-green-700 dark:text-green-100"
                    >
                      view
                    </span>
                  </button>
                </a>
              </td>
            </tr>
            <% } %>
            <!--  -->
          </tbody>
        </table>
      </div>
      <div
        class="grid px-4 py-3 text-xs font-semibold tracking-wide text-gray-500 uppercase border-t dark:border-gray-700 bg-gray-50 sm:grid-cols-9 dark:text-gray-400 dark:bg-gray-800"
      >
        <span class="flex items-center col-span-3"> Showing 21-30 of 100 </span>
        <span class="col-span-2"></span>
        <!-- Pagination -->
        <span class="flex col-span-4 mt-2 sm:mt-auto sm:justify-end">
          <nav aria-label="Table navigation">
            <ul class="inline-flex items-center">
              <li>
                <button
                  class="px-3 py-1 rounded-md rounded-l-lg focus:outline-none focus:shadow-outline-purple"
                  aria-label="Previous"
                >
                  <svg
                    aria-hidden="true"
                    class="w-4 h-4 fill-current"
                    viewBox="0 0 20 20"
                  >
                    <path
                      d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
                      clip-rule="evenodd"
                      fill-rule="evenodd"
                    ></path>
                  </svg>
                </button>
              </li>
              <li>
                <button
                  class="px-3 py-1 rounded-md focus:outline-none focus:shadow-outline-purple"
                >
                  1
                </button>
              </li>
              <li>
                <button
                  class="px-3 py-1 rounded-md focus:outline-none focus:shadow-outline-purple"
                >
                  2
                </button>
              </li>
              <li>
                <button
                  class="px-3 py-1 text-white transition-colors duration-150 bg-purple-600 border border-r-0 border-purple-600 rounded-md focus:outline-none focus:shadow-outline-purple"
                >
                  3
                </button>
              </li>
              <li>
                <button
                  class="px-3 py-1 rounded-md focus:outline-none focus:shadow-outline-purple"
                >
                  4
                </button>
              </li>
              <li>
                <span class="px-3 py-1">...</span>
              </li>
              <li>
                <button
                  class="px-3 py-1 rounded-md focus:outline-none focus:shadow-outline-purple"
                >
                  8
                </button>
              </li>
              <li>
                <button
                  class="px-3 py-1 rounded-md focus:outline-none focus:shadow-outline-purple"
                >
                  9
                </button>
              </li>
              <li>
                <button
                  class="px-3 py-1 rounded-md rounded-r-lg focus:outline-none focus:shadow-outline-purple"
                  aria-label="Next"
                >
                  <svg
                    class="w-4 h-4 fill-current"
                    aria-hidden="true"
                    viewBox="0 0 20 20"
                  >
                    <path
                      d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                      clip-rule="evenodd"
                      fill-rule="evenodd"
                    ></path>
                  </svg>
                </button>
              </li>
            </ul>
          </nav>
        </span>
      </div>
    </div>
    <!-- Orders Table end -->
  </div>
</main>
<script
  type="text/javascript"
  src="https://code.jquery.com/jquery-1.7.1.min.js"
></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
  integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
<script>
   function orderStatus(e, i) {
    console.log("order status vannu");
    const orderId = e;
    const value = $(`#track${i}`).find(":selected").val();
    console.log(orderId, value);
    // alert(`oid = ${orderId}`);
    // alert(`value = ${value}`);
    // axios.post(`http://localhost:3000/admin/orderStatus?orderId=${orderId}&value=${value}`)

    $.ajax({
      url: "/admin/orderStatus",
      data: {
        orderId,
        value,
      },
      method: "post",
      success: (response) => {
        if (response.status) {
          const Toast = Swal.mixin({
            toast: true,
            position: "top-end",
            showConfirmButton: false,
            timer: 1000,
            timerProgressBar: true,
            didOpen: (toast) => {
              toast.addEventListener("mouseenter", Swal.stopTimer);
              toast.addEventListener("mouseleave", Swal.resumeTimer);
            },
          });

          Toast.fire({
            icon: "success",
            title: "order statuse has been changed",
          }).then(() => {
            // location.href = "/admin/orders";
            window.location.reload();
          });
        }
      },
    });
  }
</script>

<%- include('partials/footer.ejs') %>
